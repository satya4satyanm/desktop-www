var model,config={type:Phaser.WEBGL,width:640,height:480,parent:"phaser-example",fps:60,scene:{preload:preload,create:create,update:update}},game=new Phaser.Game(config);function Dice(t,s,d,i){this.x=s,this.y=d,this.stopped=!0,this.points=i,this.points2d=[];for(var e=0;e<this.points.length;e++)this.points2d[e]={x:0,y:0,z:0};this.rotations={x:0,y:0,z:0},this.finalRot={x:0,y:0,z:0},this.quad1=me.add.quad(40,40,t,0),this.quad2=me.add.quad(40,40,t,4),this.quad3=me.add.quad(40,40,t,5),this.quad4=me.add.quad(40,40,t,1),this.quad5=me.add.quad(40,40,t,2),this.quad6=me.add.quad(40,40,t,3),this.lastTime=(new Date).getTime(),this.draw2d=function(){var t=this.x,s=this.y;this.quad1.setTopLeft(this.points2d[model.quads[0][0]].x+t,this.points2d[model.quads[0][0]].y+s),this.quad1.setTopRight(this.points2d[model.quads[0][1]].x+t,this.points2d[model.quads[0][1]].y+s),this.quad1.setBottomLeft(this.points2d[model.quads[0][2]].x+t,this.points2d[model.quads[0][2]].y+s),this.quad1.setBottomRight(this.points2d[model.quads[0][3]].x+t,this.points2d[model.quads[0][3]].y+s),this.quad1.depth=this.points2d[model.quads[0][0]].z+this.points2d[model.quads[0][1]].z+this.points2d[model.quads[0][2]].z+this.points2d[model.quads[0][3]].z,this.quad2.setTopLeft(this.points2d[model.quads[1][0]].x+t,this.points2d[model.quads[1][0]].y+s),this.quad2.setTopRight(this.points2d[model.quads[1][1]].x+t,this.points2d[model.quads[1][1]].y+s),this.quad2.setBottomLeft(this.points2d[model.quads[1][2]].x+t,this.points2d[model.quads[1][2]].y+s),this.quad2.setBottomRight(this.points2d[model.quads[1][3]].x+t,this.points2d[model.quads[1][3]].y+s),this.quad2.depth=this.points2d[model.quads[1][0]].z+this.points2d[model.quads[1][1]].z+this.points2d[model.quads[1][2]].z+this.points2d[model.quads[1][3]].z,this.quad3.setTopLeft(this.points2d[model.quads[2][0]].x+t,this.points2d[model.quads[2][0]].y+s),this.quad3.setTopRight(this.points2d[model.quads[2][1]].x+t,this.points2d[model.quads[2][1]].y+s),this.quad3.setBottomLeft(this.points2d[model.quads[2][2]].x+t,this.points2d[model.quads[2][2]].y+s),this.quad3.setBottomRight(this.points2d[model.quads[2][3]].x+t,this.points2d[model.quads[2][3]].y+s),this.quad3.depth=this.points2d[model.quads[2][0]].z+this.points2d[model.quads[2][1]].z+this.points2d[model.quads[2][2]].z+this.points2d[model.quads[2][3]].z,this.quad4.setTopLeft(this.points2d[model.quads[3][0]].x+t,this.points2d[model.quads[3][0]].y+s),this.quad4.setTopRight(this.points2d[model.quads[3][1]].x+t,this.points2d[model.quads[3][1]].y+s),this.quad4.setBottomLeft(this.points2d[model.quads[3][2]].x+t,this.points2d[model.quads[3][2]].y+s),this.quad4.setBottomRight(this.points2d[model.quads[3][3]].x+t,this.points2d[model.quads[3][3]].y+s),this.quad4.depth=this.points2d[model.quads[3][0]].z+this.points2d[model.quads[3][1]].z+this.points2d[model.quads[3][2]].z+this.points2d[model.quads[3][3]].z,this.quad5.setTopLeft(this.points2d[model.quads[4][0]].x+t,this.points2d[model.quads[4][0]].y+s),this.quad5.setTopRight(this.points2d[model.quads[4][1]].x+t,this.points2d[model.quads[4][1]].y+s),this.quad5.setBottomLeft(this.points2d[model.quads[4][2]].x+t,this.points2d[model.quads[4][2]].y+s),this.quad5.setBottomRight(this.points2d[model.quads[4][3]].x+t,this.points2d[model.quads[4][3]].y+s),this.quad5.depth=this.points2d[model.quads[4][0]].z+this.points2d[model.quads[4][1]].z+this.points2d[model.quads[4][2]].z+this.points2d[model.quads[4][3]].z,this.quad6.setTopLeft(this.points2d[model.quads[5][0]].x+t,this.points2d[model.quads[5][0]].y+s),this.quad6.setTopRight(this.points2d[model.quads[5][1]].x+t,this.points2d[model.quads[5][1]].y+s),this.quad6.setBottomLeft(this.points2d[model.quads[5][2]].x+t,this.points2d[model.quads[5][2]].y+s),this.quad6.setBottomRight(this.points2d[model.quads[5][3]].x+t,this.points2d[model.quads[5][3]].y+s),this.quad6.depth=this.points2d[model.quads[5][0]].z+this.points2d[model.quads[5][1]].z+this.points2d[model.quads[5][2]].z+this.points2d[model.quads[5][3]].z},this.rotateX3DTo=function(t){for(var s=Math.sin(t),d=Math.cos(t),i=0;i<model.verts.length;i++){var e=model.verts[i],o=model.staticVerts[i],a=o.y,h=o.z;e.y=a*d-h*s,e.z=h*d+a*s}},this.rotateY3DTo=function(t){for(var s=Math.sin(t),d=Math.cos(t),i=0;i<model.verts.length;i++){var e=model.verts[i],o=model.staticVerts[i],a=o.x,h=o.z;e.x=a*d-h*s,e.z=h*d+a*s}},this.rotateZ3DTo=function(t){for(var s=Math.sin(t),d=Math.cos(t),i=0;i<model.verts.length;i++){var e=model.verts[i],o=model.staticVerts[i],a=o.x,h=o.y;e.x=a*d-h*s,e.y=h*d+a*s}},this.animate=function(){var t=this,s=(new Date).getTime(),d=.001*(s-t.lastTime);d>.1&&(d=.1);Math.abs(Math.ceil(100*t.finalRot.x)-Math.ceil(100*t.rotations.x))>3?(t.rotations.x+=2*d,t.stopped=!1):(t.rotations.x=t.finalRot.x,t.stopped=!0),Math.abs(Math.ceil(100*t.finalRot.y)-Math.ceil(100*t.rotations.y))>3?t.rotations.y+=2*d:t.rotations.y=t.finalRot.y,Math.abs(Math.ceil(100*t.finalRot.z)-Math.ceil(100*t.rotations.z))>3?t.rotations.z+=2*d:t.rotations.z=t.finalRot.z,t.lastTime=s,t.updateFrameFunc()},this.updateFrameFunc=function(){for(var t,s,d,i,e,o,a,h,n,l=this,p=Math.sin,u=Math.cos,m=l.points2d,r=p(l.rotations.x),q=u(l.rotations.x),f=p(l.rotations.y),x=u(l.rotations.y),c=p(l.rotations.z),y=u(l.rotations.z),z=0;z<l.points.length;z++)t=l.points[z].x,a=x*(e=r*(s=l.points[z].y)+q*(d=l.points[z].z))-f*t,h=y*(o=f*e+x*t)-c*(i=q*s-r*d),n=c*o+y*i,m[z].x=h,m[z].y=n,m[z].z=a;l.draw2d()}}function preload(){this.load.image("bg","bg1.png"),this.load.spritesheet("d1","d1.png",{frameWidth:80,frameHeight:80}),this.load.spritesheet("d2","d2.png",{frameWidth:80,frameHeight:80}),this.load.spritesheet("d3","d3.png",{frameWidth:80,frameHeight:80}),this.load.spritesheet("d4","d4.png",{frameWidth:80,frameHeight:80}),this.load.spritesheet("d5","d5.png",{frameWidth:80,frameHeight:80}),this.load.spritesheet("d6","d6.png",{frameWidth:80,frameHeight:80}),this.load.spritesheet("d7","d7.png",{frameWidth:80,frameHeight:80}),this.load.spritesheet("d8","d8.png",{frameWidth:80,frameHeight:80}),this.load.image("roll","roll.png")}function create(){model={staticVerts:[{x:-20,y:-20,z:20},{x:20,y:-20,z:20},{x:20,y:20,z:20},{x:-20,y:20,z:20},{x:-20,y:-20,z:-20},{x:20,y:-20,z:-20},{x:20,y:20,z:-20},{x:-20,y:20,z:-20}],verts:[{x:-20,y:-20,z:20},{x:20,y:-20,z:20},{x:20,y:20,z:20},{x:-20,y:20,z:20},{x:-20,y:-20,z:-20},{x:20,y:-20,z:-20},{x:20,y:20,z:-20},{x:-20,y:20,z:-20}],quads:[[0,1,3,2],[4,0,7,3],[5,4,6,7],[1,5,2,6],[3,2,7,6],[4,5,0,1]]},me=this;dices=[],this.add.image(0,0,"bg").setOrigin(0,0).alpha=.1,d1=new Dice("d1",165,120,model.verts),dices.push(d1),d2=new Dice("d2",250,120,model.verts),dices.push(d2),d3=new Dice("d3",340,120,model.verts),dices.push(d3),d4=new Dice("d4",425,120,model.verts),dices.push(d4),d5=new Dice("d5",145,200,model.verts),dices.push(d5),d6=new Dice("d6",245,200,model.verts),dices.push(d6),d7=new Dice("d7",345,200,model.verts),dices.push(d7),d8=new Dice("d8",445,200,model.verts),dices.push(d8);var t=this.add.image(300,300,"roll");t.setInteractive(),t.on("clicked",startRoll,this),this.input.on("gameobjectup",function(t,s){s.emit("clicked",s)},this),this.lastTime=(new Date).getTime(),this.add.text(130,16,"Phaser 3 3d rotating Dice",{fontSize:"22px",fill:"#fff"}),this.t=this.add.text(80,350,"Works with Phaser 3 Quads",{fontSize:"30px",fill:"#ffb900",fontWeight:600}),this.add.text(130,416,"Phaser 3 3d rotating Dice",{fontSize:"22px",fill:"#fff"})}function startRoll(t){var s={x:0,y:0,z:0},d={x:0,y:4.71238898038469,z:0},i={x:1.5707963267948966,y:0,z:0},e={x:4.71238898038469,y:0,z:0},o={x:0,y:1.5707963267948966,z:0},a={x:0,y:3.141592653589793,z:0};rands=[],dices[0].stopped&&dices.forEach(function(t){var h=Math.ceil(6*Math.random());t.rand=h,1==h&&(t.finalRot=s),2==h&&(t.finalRot=d),3==h&&(t.finalRot=i),4==h&&(t.finalRot=e),5==h&&(t.finalRot=o),6==h&&(t.finalRot=a),t.rotations={x:t.finalRot.x-28,y:t.finalRot.y-28,z:t.finalRot.z-28},rands.push(h-1)})}function update(){for(var t=0;t<dices.length;t++){var s=dices[t];s.animate(),s.stopped}}rands=[],highLow=null,total=0;